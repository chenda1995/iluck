!function(){"use strict";function e(){var e="1";return q.isMobile&&(e="m1"),q.isIos&&q.isNative?e="am0":q.isAndroid&&q.isNative&&(e="am1"),e}function t(){var e=R.getValue(T.ptp_cnt_b);if(e)return e;var t="",n=location.href.split("?")[0];return t=D.pageHash(n)}function n(){var e=R.getCookieOrFunc(T.cpsinfo);return e?e=e.replace("-",","):""}function r(e){if(e){var t=R.getValue(T.urlExtendFn,e);return R.hasKey(t)?t:void 0}}function i(e){if(e){e.length&&(e=e[0]);var t=R.getValue(T.ptp_cnt_c_d,e);if(t)return t;var n=e.getAttribute("data-ptp-customc");if(n)return{c:n,d:z.getIndex("data-ptp-customc",n,e)};if(e=z.getParents(e,"data-ptp-customc"))return n=e.getAttribute("data-ptp-customc"),n?{c:n,d:z.getIndex("data-ptp-customc",n,e)}:void 0}}function o(){return R.getCookieOrFunc(T.uuid)}function a(e,t){return e||(e=H.c),t||(t=H.d),[H.a,H.b,e,t,H.e].join(".")}function u(e){window.PTP_PARAMS&&R.extend(T,window.PTP_PARAMS);var t=document.referrer,r=R.getQuery("ptp",location.search),i=R.getQuery("ptp",document.referrer?document.referrer:""),o=navigator.userAgent.toLocaleLowerCase();q.isNative=T.isNativeRe.test(o);var u=location.href,c=u.split("#")[1];if(c=c?"?"+c:"",T.urlHash){for(var d in T.urlHash)T.urlHash.hasOwnProperty(d)&&(c=R.setQuery(c,d,encodeURIComponent(T.urlHash[d])));u=u.split("#")[0]+c.replace("?","#")}return e&&U&&U.url!=u&&(t=U.url,r=a(0,0),i=U.ptp_url),{time:R.getTime(),ver:"1.2.0",uid:R.getCookieOrFunc(T.uid),_channel:"","tid-token":"",launchTime:R.getTime(),active:0,deviceName:"",os_ver:"",root:0,network:0,provider:"",url:u,refer:t,ptp_url:r,ptp_ref:i,eid:"0",ext:{cpsparam:R.getCookie("__cps"),cpsinfo:n(),_notNative:!q.isNative}}}function c(n){H.a=e(),H.b=n||t(),H.c=0,H.d=0}function d(e,t){t=t||{};var n=[];for(var r in t){var i=t[r];i||(i=""),i=encodeURIComponent(i),n.push(r+"="+i)}n=n.join("&"),e=e.indexOf("?")>-1?e+"&"+n:e+"?"+n;var o=new Image;o.src=e}function f(e,t){e+="?web=1",t=t||{};var n,r=J++;try{n=document.createElement('<iframe name="'+r+'">')}catch(i){n=document.createElement("iframe"),n.setAttribute("name",r)}try{n.style.display="none",document.body.appendChild(n),n.contentWindow.name=r;var o=document.createElement("form");o.setAttribute("method","POST"),o.setAttribute("action",e),o.setAttribute("target",r);for(var a in t)if(t.hasOwnProperty(a)){var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name",a),u.setAttribute("value",t[a]),o.appendChild(u)}document.body.appendChild(o),o.submit(),R.registerEvent(n,"load",function(){try{document.body.removeChild(o),document.body.removeChild(n)}catch(e){}})}catch(i){window.M&&M.log(i)}}function s(){if(!Z){Z=!0;for(var e=0;e<X.length;e++)X[e].fn.call(window,X[e].ctx);X=[]}}function p(){"complete"===document.readyState&&s()}function l(e,t){return Z?void setTimeout(function(){e(t)},1):(X.push({fn:e,ctx:t}),void("complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(s,1):G||(document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):(document.attachEvent("onreadystatechange",p),window.attachEvent("onload",s)),G=!0)))}function g(){return Y}function m(e,t,n){"undefined"!=typeof e&&(t=t||{},n&&window.M&&M.web.AB&&(t.abinfo=M.web.AB.formatAB(n)),l(function(){var n=W.getPtpInfoAndExtra(t);n.eid=e+"",g()?K.logData("e",R.extend({},n)):R.listenTo("LoggerReady",function(){var e=W.getPtpInfoAndExtra(t);K.logData("e",R.extend({},e))}),window.MtaH5&&MtaH5.clickStat&&MtaH5.clickStat(e,t)}))}function v(){var e=W.getPtpInfoAndExtra(),t=R.getValue(T.pEventId);e.eid=t,K.logData("p",e)}function h(e,t,n){if(q.isNative){var r=W.getPtpCnt();t?K.logAppCustomPevent(r,e,n):window.M&&M.web.AB&&M.web.AB.isAB?M.web.AB.collectExps().then(function(e){e.length?K.logAppPevent(r,e):K.logAppPevent(r)}):K.logAppPevent(r)}else g()?v():R.listenTo("LoggerReady",function(){v()})}function w(e,t,n){R.isArray(t)&&(n=t,t=""),l(function(){W.refreshPtp(t,!0),W.refreshE(),h(e,!0,n)})}function y(e){var t=e.href;if(!(t.indexOf("mogujie.com/mtalk/")>-1)&&(T.hrefRe.test(t)||T.mgjRe.test(t))){var n=e.getAttribute("data-ptp-cache-id");t=e.getAttribute("href"),n&&T.ptpRe.test(n)||(n=W.createPtpCnt(e),e.setAttribute("data-ptp-cache-id",n)),e.href=W.makeUrl(t,n,e)}}function x(e){if(e.getAttribute){var t=e.getAttribute("href");if(null===t)return!1;if(0===t.indexOf("#")&&"_blank"!==e.getAttribute("target"))return!1}return!0}function A(e){var t=e||window.event,n=t.target||t.srcElement,r=z.getA(n),i="AREA"===n.nodeName?n:null;i&&(r=i),r&&(r.href&&r.href.indexOf("javascript:")>-1||x(r)&&y(r))}function P(e){var t=document.createElement("iframe");t.src=e,t.style.display="none",document.body&&document.body.appendChild(t)}function E(e,t){if("undefined"==typeof e)return"";var n="";return n=t?W.createPtpCnt(t):W.getPtpCnt(),W.makeUrl(e,n,t)}function b(){var e=E("");e=e.split("?")[1],e=e.split("&");for(var t,n="",r=0,i=e.length;r<i;r++)t=e[r].split("="),n+='<input type="hidden" name="'+t[0]+'" value="'+(t[1]?t[1]:"")+'"/>';return n}function C(e,t){e&&"string"==typeof e&&((T.hrefRe.test(e)||T.mgjRe.test(e))&&(e=E(e,t)),window.location.href=e)}function _(e,t){void 0===t&&(t="navigateTo"),e=E(e),e=R.setQuery(e,"_mgjuuid",R.getCookieOrFunc(T.uuid)),window.wx&&wx.miniProgram&&wx.miniProgram[t]&&wx.miniProgram[t]({url:e,fail:function(){"navigateTo"===t?wx.miniProgram.redirectTo({url:e,fail:function(){wx.miniProgram.switchTab({url:e})}}):"redirectTo"===t&&wx.miniProgram.switchTab({url:e})}})}"undefined"==typeof location.search&&(location.search=location.href.split("#")[0]);var j=1001,k={},L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=/(&|<|>|"|`|')/g,R={escapeHtml:function(e){return e.replace(I,function(e){return L[e]})},isIE:function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===t.getElementsByTagName("i").length},stringify:function(e){var t=this;if("undefined"!=typeof JSON)return JSON.stringify(e);var n=typeof e;if("object"!=n||null===e)return"string"==n&&(e='"'+e+'"'),String(e);var r,i,o=[],a=e&&e.constructor==Array;for(r in e)i=e[r],n=typeof i,e.hasOwnProperty(r)&&("string"==n?i='"'+i+'"':"object"==n&&null!==i&&(i=t.stringify(i)),o.push((a?"":'"'+r+'":')+String(i)));return(a?"[":"{")+String(o)+(a?"]":"}")},isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},getCookieInArray:function(e){for(var t=this,n=0,r=e.length;n<r;n++){var i=t.getCookie(e[n]);if(i)return i}return""},getCookieOrFunc:function(e){return"function"==typeof e?this.getValue(e):this.getCookie(e)},getCookie:function(e){if(this.isArray(e))return this.getCookieInArray(e);var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!==t?decodeURIComponent(t[2]):""},getQuery:function(e,t){"undefined"==typeof t&&(t=location.search);var n="(^|&|\\?)"+e+"=([^&]*)(&|$)",r=new RegExp(n,"i"),i=t.substr(1).match(r);return null!==i?this.escapeHtml(decodeURIComponent(i[2])):""},setQuery:function(e,t,n){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=e.indexOf("?")!==-1?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+n+"$2"):e+i+t+"="+n},getTime:function(){return(new Date).getTime()},registerEvent:function(e,t,n){window.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},extend:function(){for(var e=arguments,t=arguments[0],n=1;n<e.length;n++){var r=e[n];for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t},getValue:function(e){if(e){if("function"==typeof e)try{var t=Array.prototype.slice.call(arguments,1);return e.apply(null,t)}catch(n){return window.M&&window.M.log("**logger.js---\u6253\u70b9\u51fa\u9519:"+n),""}return e}},loadScript:function(e,t,n){if(window["callback_"+j]=function(e){t&&t(e)},e=this.setQuery(e,"callback","callback_"+j),j+=1,n)window.loader.script(e,function(){},function(){});else{var r=document.createElement("script");r.src=e;var i=document.getElementsByTagName("head")[0];i&&i.appendChild(r)}},listenTo:function(e,t){k[e]||(k[e]=[]),k[e].push(t)},fire:function(e){var t=k[e];if(t&&t.length){for(var n=0,r=t.length;n<r;n++)t[n].call();k[e]=[]}},hasKey:function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}},N="https:"===location.protocol?"https:":"http:",O="mogujie";location.host.indexOf("meilishuo")!=-1&&(O="meilishuo");var T={LogUrl:N+"//log.mogujie.com/log",CookieUrl:N+"//portal."+O+".com/api/util/getUuid",shouldRequestCookie:function(){var e=R.getCookieOrFunc(this.uuid);return!e},uuid:["__mgjuuid","__xduuid"],uid:"__ud_",cpsinfo:"__cpsinfo",ptp_cnt_a:"",ptp_cnt_b:"",ptp_cnt_c_d:"",platform:function(){var e=navigator.userAgent.toLowerCase();if(/qq\/([\d\.]+)/.test(e)||/qzone\//.test(e))return 48},pEventId:"0",isMobileRe:/iphone|android|ipad/i,ptpRe:/[a-z0-9]+\.[a-z0-9]+\.[a-z0-9]+\.[a-z0-9]+\.[a-z0-9]+/i,hrefRe:/http[s]?:\/\/(\w+\.){1,2}(mogujie|meilishuo|xiaodian|uniny)\.com([\/]|\/.*|)$/,mgjRe:/(mgj|mls):\/\//,mtRe:/\?.*[&]?mt=([^\.]+)\.([^\.]+)\.([^\.&#]+)/,chasing:["f","f2","mlf","s","_fu","_wvx"],urlExtend:["acm","cparam"],urlExtendFn:function(){},urlHash:"",urlCustom:"",extra:{},isNativeRe:/(mogujie|meilishuo|mls|mgjtuangou|xiaodian|xcore)/i,nativeLog:{}},S=navigator.userAgent.toLocaleLowerCase(),B=!1,Q=S.indexOf("xcore")>-1;Q&&window.loader&&window.loader.script&&(B=!0);var U,H,q={isWX:S.indexOf("micromessenger")>-1,isApp:T.isNativeRe.test(S),isNative:T.isNativeRe.test(S),isMobile:T.isMobileRe.test(S),isIos:S.indexOf("iphone")>-1,isAndroid:S.indexOf("android")>-1,isLowIE:!B&&(R.isIE(6)||R.isIE(7)||R.isIE(8)),xcore:B},F=window.jQuery||window.Zepto,V=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]==t)return n+1;return-1},z={getA:function(e){var t=e;if("A"==t.tagName)return e;for(;t.parentNode;)if(t=t.parentNode,"A"==t.tagName)return t},getParentByClass:function(e,t){if(e){if(F)return $(e).parents("."+t);for(var n,r=e;r.parentNode;)if(r=r.parentNode,n=r.className&&r.className.indexOf(t)!=-1)return r}},getParents:function(e,t){if(e){if(t=t||"",F)return t="["+t+"]",$(e).parents(t)[0];for(var n,r=e;r.parentNode;)if(r=r.parentNode,n=r.getAttribute&&r.getAttribute(t))return r}},getIndex:function(e,t,n){if(!e||!t||!n)return 0;if(F)return $("["+e+'="'+t+'"]').index($(n))+1;if(document.querySelectorAll){var r=document.querySelectorAll("["+e+'="'+t+'"]');return V(r,n)}return 1},getElemIndex:function(e,t,n){if(!e||!t||!n)return 0;if(F)return $(e).find(t).index($(n))+1;if(e.querySelectorAll){var r=e.querySelectorAll(t);return V(r,n)}return 1},is:function(e,t){return!(!e||!t)&&(e.length&&(e=e[0]),e.nodeName.toLowerCase()===t.toLowerCase()||void 0)}},D={arr:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",rand:function(e){var t,n,r=this,i="",o=0;for(t=0;t<e;t++)n=parseInt(Math.random()*r.arr.length,10),i+=r.arr.charAt(n),o+=r.arr.charCodeAt(n);return i+=this.arr.charAt(o%this.arr.length)},pageHash:function(e){var t=this,n=5381,r=e.length-1;if("string"==typeof e)for(;r>-1;r--)n+=(n<<5)+e.charCodeAt(r);else for(;r>-1;r--)n+=(n<<5)+e[r];var i=2147483647&n,o="";do o+=t.arr.charAt(61&i),i>>=6;while(i);return o}};U=u(),H={a:e(),b:t(),c:0,d:0,e:T.ptp_cnt_e?T.ptp_cnt_e:D.rand(7)};var W={getPlatform:function(){var e=R.getValue(T.platform);return e?e:q.isMobile?32:31},getPtpByType:function(e){var t=[0,o(),e];return t},getPtpCnt:function(e,t){return a(e,t)},getPtpInfo:function(e,t){var n={};return R.extend(n,U,{ptp_cnt:this.getPtpCnt(e,t)})},getPtpInfoAndExtra:function(e){e=e||{};var t=this.getPtpInfo(e.ptp_c,e.ptp_d),n={};if(T.extra)for(var r in T.extra)T.extra.hasOwnProperty(r)&&(n[r]=R.getValue(T.extra[r]));var i=R.extend({},t.ext,n,e);return R.extend({},t,{ext:i})},createPtpCnt:function(e){var t=i(e),n=0,r=0;if(t)return this.getPtpCnt(t.c,t.d);var o=z.getParents(e,"data-ptp"),a=z.getParentByClass(e,"data-ptp-item");return o&&(n=o.getAttribute("data-ptp"),r=a?z.getElemIndex(o,".data-ptp-item",a):z.getElemIndex(o,"a",e)),r||(r=0),this.getPtpCnt(n,r)},makeUrl:function(e,t,n){var r=e.match(/(#.+)$/);return e=e.replace(/(#.+)$/,""),e=R.setQuery(e,"ptp",t),e=this.getChasingParams(e),e=this.getExtendParams(n,e),r&&(e+=r[1]),e},getChasingParams:function(e){"undefined"==typeof e&&(e="");var t=e;if(!T.chasing)return t;T.chasing.length||(T.chasing=[T.chasing]);for(var n,r,i=0,o=T.chasing.length;i<o;i++)n=T.chasing[i],r=R.getQuery(n),r&&(t=R.setQuery(t,n,r));for(var a=location.search,u=/[\?&](_f_[^=]+)=([^&]+)/g,c=u.exec(a);c&&3==c.length;)t=R.setQuery(t,c[1],c[2]),c=u.exec(a);return t},getExtendParams:function(e,t){var n=t;if(!e||!z.is(e,"a"))return n;var i=r(e);if(i)for(var o in i)i.hasOwnProperty(o)&&(n=R.setQuery(n,o,i[o]));else{e.length&&(e=e[0]);for(var a=T.urlExtend||[],u=0,c=a.length;u<c;u++){var d=a[u],f=e.getAttribute("data-ext-"+d);f&&(n=R.setQuery(n,d,f))}}return n},refreshPtp:function(e,t){U=u(t),c(e)},refreshE:function(){H&&(H.e=D.rand(7))}},J=0,K={sendLog:function(e,t){q.isLowIE?f(e,t):d(e,t)},sendAppLog:function(e,t){return e+="",T.nativeLog&&T.nativeLog.logE?T.nativeLog.logE(e,t):void(window.hdp&&window.hdp.exec?hdp.exec("mgj.tracker.sendEvent",e,t):document.addEventListener("deviceready",function(){window.mgj&&mgj.tracker&&mgj.tracker.sendEvent&&mgj.tracker.sendEvent(e,t)},!1))},logAppPevent:function(e,t){return T.nativeLog&&T.nativeLog.logP?T.nativeLog.logP(e,t):void(window.hdp&&window.hdp.exec?hdp.exec("mgj.pevent",e,t).then(function(){},function(){}):document.addEventListener("deviceready",function(){window.mgj&&mgj.pevent&&mgj.pevent(function(){},null,e)},!1))},logAppCustomPevent:function(e,t,n){window.hdp&&window.hdp.exec?hdp.exec("mgj.tracker.sendPEvent",t,e,n,!0):document.addEventListener("deviceready",function(){window.mgj&&mgj.tracker&&mgj.tracker.sendPEvent(function(){},function(){},t,e,n,!0)},!1)},logData:function(e,t){var n=W.getPtpByType(e),r=t.eid;if(n.push(R.stringify(t)),q.isNative){var i=t.ext;i.ptp_cnt=t.ptp_cnt,i.ptp_url=t.ptp_url,i.ptp_ref=t.ptp_ref,i.uid=t.uid,i._11_url=location.href,i._11_refer=document.referrer||"",K.sendAppLog(r,i)}else K.sendLog(T.LogUrl,{v:2,pt:R.getTime(),pf:W.getPlatform(),data:n.join("\t")})}},X=[],Z=!1,G=!1,Y=q.isNative||!T.shouldRequestCookie();Y||R.loadScript(T.CookieUrl,function(){Y=!0,R.fire("LoggerReady")},q.xcore);var ee=navigator.userAgent.toLocaleLowerCase();if(ee.indexOf("meili-pevent=true")!==-1&&!q.xcore&&!q.isIos){var te=T.urlCustom,ne=W.getPtpCnt(),re="meili://pevent?param="+ne;te&&(re+="&url="+encodeURIComponent(te)),window.M&&M.web.AB&&M.web.AB.isAB?M.web.AB.collectExps().then(function(e){e.length&&(re+="&abtest="+encodeURIComponent(e.join(","))),P(re)})["catch"](function(){P(re)}):P(re)}var ie={version:"1.2.0",ptp:W,config:T,util:R,info:q,send:K,refreshPevent:w,log:m,generatePtpParams:E,generatePtpForm:b,goTo:C,goToWxa:_};if(window.logger=ie,!q.xcore){var oe="tap"in document.createElement("div")?"tap":"mousedown";R.registerEvent(document,oe,A),R.registerEvent(document,"touchstart",A)}return l(function(){W.refreshPtp(),h()}),ie}();
